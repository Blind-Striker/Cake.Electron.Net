trigger:
  branches:
    include:
      - master
      - releases/*
      - feature/*
pr: none
pool:
  name: Hosted Ubuntu 1604
steps:
  - bash: "sudo apt install nuget && mkdir ./testrunner && sudo chmod -R 777 ./testrunner && ls"
    displayName: "Init Task"

  - task: Bash@3
    displayName: "Compile & Tests"
    inputs:
      targetType: filePath
      filePath: ./build.sh

  - bash: echo $BUILD_ID && chmod +x ./build.sh && sudo ./build.sh --target=get-version --buildnumber=$BUILD_ID
    displayName: "Package Version"
    env:
      BUILD_ID: $(Rev:r)

  - bash: chmod +x ./build.sh && sudo ./build.sh --target=nuget-pack --buildnumber=$BUILD_ID
    displayName: "Nuget Pack"
    env:
      BUILD_ID: $(Rev:r)

  - task: PublishBuildArtifacts@1
    displayName: "Publish Artifact: Cake.Electron.Net"
    inputs:
      PathtoPublish: artifacts/
      ArtifactName: Cake.Electron.Net